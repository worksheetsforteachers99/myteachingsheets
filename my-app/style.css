
:root {
      --brand: #005f73;
      --brand-dark: #003d4d;
      --accent: #0a9396;
      --accent-dark: #056b6f;
      --bg: #e9f1f7;
      --fg: #102a43;
      --card: #fff;
      --radius: 0.75em;
      --shadow: 0 4px 20px rgba(0,0,0,0.1);
      --error: #dc3545;
      --success: #28a745;
      --header-height: 56px;
      --footer-height: 56px;
      /* Column width tokens used by the shared colgroup */
      --col-grade:     64px;
      --col-lesson:   140px;
      --col-worksheet:160px;
      --col-answer:   160px;
      --col-lastedit: 110px;
  --col-package:  140px;
    }
      /* Utilities and moved inline styles from index.html */
      /* Separator inside panels */
      #lesson-search-panel hr,
      .panel-sep {
        margin: 1rem 0;
        border: none;
        height: 1px;
        background: rgba(16,42,67,0.06);
      }

      /* Column variant for button rows */
      .button-row.column {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      /* Small version badge used in panel footers */
      .version-badge {
        margin-top: auto;
        font-size: 0.8rem;
        color: #6c757d;
        text-align: center;
        padding-top: 1rem;
      }


      /* Main app and bulk container defaults */
      .main-app { background: transparent; }
      #bulkTableContainer { background: transparent; }

      /* Modal overlay and dialog moved from inline styles */
      #replaceModal {
        display: none;
        position: fixed;
        inset: 0; /* top:0; right:0; bottom:0; left:0; */
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index: 10;
      }
      #replaceModal .modal-dialog {
        background: #fff;
        padding: 1.5rem;
        border-radius: 0.5rem;
        max-width: 400px;
        width: 90%;
        text-align: center;
      }

      #payoutModal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
        z-index: 10;
      }
      #payoutModal .modal-dialog {
        background: #fff;
        padding: 1.5rem;
        border-radius: 0.5rem;
        max-width: 500px;
        width: 90%;
      }
      #payoutModal h3 {
        margin-top: 0;
        margin-bottom: 1rem;
        color: #333;
      }
      #payoutModal .payout-details {
        margin-bottom: 1.5rem;
      }
      #payoutModal .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.75rem;
        padding: 0.5rem 0;
        border-bottom: 1px solid #eee;
      }
      #payoutModal .detail-label {
        font-weight: bold;
        color: #555;
      }
      #payoutModal .detail-value {
        color: #333;
      }
      #payoutModal form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      #payoutModal label {
        font-weight: bold;
        margin-bottom: 0.25rem;
      }
      #payoutModal input {
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 0.25rem;
        font-size: 1rem;
      }
      #payoutModal .hidden {
        display: none !important;
      }

      /* Hidden utility */
      .hidden { display: none !important; }

    /* Hide stop bulk button by default (used in index.html) */
    #btnStopBulk.hidden { display: none !important; }

      /* Spinner defaults and visible helper */
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .spinner {
        display: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid rgba(0,0,0,0.12);
        border-top-color: rgba(0,0,0,0.4);
        animation: spin 0.8s linear infinite;
      }
      .spinner.visible { display: inline-block; }
      /* Specific loading overlay spinner adjustments */
      .loading-overlay .spinner { display: block; position: static; transform: none; }
            

    /* Table/menu helpers */
    .menu-cell-padding { padding-right: 0.5em; }
    .error-cell { color: red; }

        /* Domain header cell layout used in main bulk table */
        .domain-header-cell {
          display: flex;
          align-items: center;
          justify-content: space-between;
          font-weight: 600;
          padding: 0.6rem 1rem;
          background: #f4f4f4;
        }

        .domain-actions {
          display: inline-flex;
          gap: .5rem;
        }

        /* === Domain Cards (per-domain mini-table) === */
        .domain-card {
          background:#fff;
          border:1px solid rgba(16,42,67,0.08);
          border-radius:12px;
          box-shadow: 0 6px 18px rgba(16,42,67,0.06);
          margin: 14px 0;
          overflow:hidden;
        }

        .domain-card__header{
          display:flex; align-items:center; justify-content:space-between;
          gap:12px; padding:10px 14px;
          background: linear-gradient(180deg,#f8fbfd, #f2f7fa);
          border-bottom:1px solid rgba(16,42,67,0.08);
          position: sticky; top: 0; z-index: 1;
        }
        .domain-card__title{ font-size:15px; font-weight:700; letter-spacing:.2px; color:var(--fg); }
        .domain-card__meta{ font-size:12px; color:#5b7083; }

        .domain-actions{ display:inline-flex; gap:8px; }
        .domain-actions .btn-icon{
          width:32px; height:32px; display:inline-flex; align-items:center; justify-content:center;
          border-radius:8px; background:#fff; border:1px solid rgba(16,42,67,0.08); cursor:pointer;
        }
        .domain-actions .btn-icon:hover{ background:#f6fbfc; box-shadow:0 2px 6px rgba(16,42,67,0.06); }

        /* Slightly smaller icons in the domain header next to title */
        .domain-card__header .domain-actions .btn-icon { width:28px; height:28px; }
        .domain-card__header .domain-actions .btn-icon svg { width:16px; height:16px; }

        .domain-table{ width:100%; border-collapse: separate; border-spacing:0; table-layout: fixed; }
        .domain-table thead th{
          background: var(--brand); color:#fff; font-weight:600;
          padding:10px 12px; text-align:left; position: sticky; top: 44px; z-index: 1;
        }
        .domain-table thead th:first-child{ border-top-left-radius:8px; }
        .domain-table thead th:last-child{ border-top-right-radius:8px; }
        .domain-table th, .domain-table td{
          white-space:nowrap; border-bottom:1px solid rgba(16,42,67,0.06); padding:10px 12px; background:#fff;
        }
        .domain-table tbody tr:nth-child(odd){ background:#fafbfd; }
        .domain-table tbody tr:hover{ background:#f5fbff; }

        /* Keep only the Package column sticky on the right */
        .domain-table th.menu-cell, .domain-table td.menu-cell{ z-index: 2; background: #fff; }
        .domain-table th.menu-cell.package, .domain-table td.menu-cell.package{
          position: sticky; right: 0; /* package is now the rightmost sticky column */
          box-shadow: -4px 0 8px rgba(16,42,67,.06);
        }

        /* Responsive: disable sticky package column on narrow screens to avoid horizontal overflow */
        @media (max-width: 1000px) {
          .domain-table th.menu-cell.package, .domain-table td.menu-cell.package{
            position: static;
            right: auto;
            box-shadow: none;
          }
          /* allow package cell content to wrap and shrink on small screens */
          .domain-table th.menu-cell.package, .domain-table td.menu-cell.package{ white-space: normal; }
        }

        /* Optional density support you can toggle with .table-dense */
        .table-dense .domain-table th, .table-dense .domain-table td { padding:7px 10px; }

        /* Shared header for the per-domain mini-tables */
        .domain-shared-header {
          /* keep the shared header inline with content to avoid double offsets
             previous sticky top used the header-height and caused extra space
             because .main-content already adds padding for the fixed app header */
          position: relative;
          top: 0;
          z-index: 4;
          background: transparent;
          margin: 0 0 8px 0;
        }
        .shared-header-table { width: 100%; border-collapse: separate; border-spacing:0; }
        .shared-header-table thead th{ background: #0a5f73; color: white; padding:10px 12px; }

        /* Ensure the shared header's Package cell remains styled (brand bg + white text) */
        .domain-shared-header .shared-header-table thead th.menu-cell.package {
          background: var(--brand) !important;
          color: #fff !important;
        }

        /* Collapse per-domain theads so no empty vertical space remains while keeping COLGROUP present for sizing */
        .domain-card .domain-table thead {
          display: none;
          margin: 0;
          padding: 0;
          border: none;
          height: 0;
        }

        .btn-action {
          font: inherit;
          padding: .25rem .5rem;
          border: 1px solid var(--border, #ddd);
          border-radius: .375rem;
          background: #fff;
          cursor: pointer;
        }
        /* Modern Done / Completed buttons */
        .btn-done {
          padding: .35rem .6rem;
          border-radius: 8px;
          background: linear-gradient(180deg, #fff 0%, #f6fbfc 100%);
          border: 1px solid rgba(16,42,67,0.08);
          color: #0b7285;
          font-weight: 700;
          letter-spacing: .4px;
          cursor: pointer;
          box-shadow: 0 2px 8px rgba(11,114,133,0.06);
        }
        .btn-done:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(11,114,133,0.08); }

        .btn-completed {
          padding: .35rem .6rem;
          border-radius: 8px;
          background: linear-gradient(180deg, #e6ffef 0%, #dff7ea 100%);
          border: 1px solid rgba(34,197,94,0.15);
          color: #0f5132;
          font-weight: 700;
          letter-spacing: .4px;
          cursor: pointer;
          box-shadow: 0 2px 8px rgba(34,197,94,0.04);
        }
        .btn-completed[disabled] { opacity: 0.8; cursor: default; }
        /* Icon-style compact buttons used in domain headers */
        .btn-icon {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 32px;
          height: 32px;
          padding: 0;
          border-radius: 6px;
          background: #ffffff;
          border: 1px solid rgba(16,42,67,0.06);
          color: var(--fg);
        }
        /* Allow SVGs to use fill by default; many icons use fill instead of stroke. */
        .btn-icon svg { display: block; width:100%; height:100%; }
        /* helper class for intentionally filled icons */
        .filled-icon { fill: currentColor; }
        .btn-icon:hover { background: #f6fbfc; box-shadow: 0 2px 6px rgba(16,42,67,0.04); }
        .btn-action.blinking-ui { animation: blink 1s linear infinite; }

        * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
        
    body {
      display: flex; 
      flex-direction: column;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--bg) 0%, #cce7f0 100%);
      font-family: 'Segoe UI', sans-serif; 
      color: var(--fg);
    }

    /* Header Styles */
    .app-header {
      height: var(--header-height);
      background: linear-gradient(135deg, var(--brand) 0%, var(--brand-dark) 100%);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex; /* Visible by default */
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      width: 100%;
      z-index: 1000;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
      text-decoration: none;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .earnings-display {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255,255,255,0.1);
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      color: white;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .earnings-updating {
      background: rgba(255,255,255,0.2) !important;
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }

    .earnings-updated {
      background: rgba(40, 167, 69, 0.8) !important;
      animation: successPulse 1s ease-out;
    }

    @keyframes successPulse {
      0% { 
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(40, 167, 69, 0.6);
      }
      50% { 
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(40, 167, 69, 0.8);
      }
      100% { 
        transform: scale(1);
        box-shadow: 0 0 10px rgba(40, 167, 69, 0.4);
      }
    }

    .earnings-icon {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    .user-profile {
      position: relative;
    }

    .profile-button {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.22);
      padding: 0.35rem 0.65rem;
      border-radius: 999px; /* pill */
      color: #fff;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
      font-size: 0.9rem;
      font-weight: 500;
      line-height: 1;
    }

    .profile-button:hover {
      background: rgba(255,255,255,0.12);
      border-color: rgba(255,255,255,0.28);
    }

    .profile-button:active {
      transform: translateY(0);
    }

    .profile-avatar {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #e6eef5;
      color: #264653;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .profile-info {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 0;
    }

    .profile-username {
      font-weight: 600;
      line-height: 1.1;
      font-size: 0.88rem;
      max-width: 130px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .profile-account {
      font-size: 0.74rem;
      opacity: 0.8;
      line-height: 1.1;
      max-width: 130px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .profile-dropdown {
      position: absolute;
      top: calc(100% + 0.5rem);
      right: 0;
      background: #ffffff;
      border: 1px solid #e6ebf0;
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(16,42,67,0.08);
      min-width: 220px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-6px);
      transform-origin: top right;
      transition: opacity 0.18s ease, transform 0.18s ease, visibility 0.18s ease;
      z-index: 1001;
      overflow: visible; /* allow submenu to extend outside */
    }
    .profile-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-header {
      padding: 0.75rem 0.9rem;
      border-bottom: 1px solid #eef2f6;
      background: #ffffff;
    }

    .dropdown-username {
      font-weight: 600;
      color: var(--fg);
      margin-bottom: 0.25rem;
    }

    .dropdown-account {
      font-size: 0.85rem;
      color: #6c757d;
    }

    .dropdown-menu {
      padding: 0.25rem;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.55rem 0.6rem;
      color: var(--fg);
      text-decoration: none;
      transition: background-color 0.12s ease;
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 0.9rem;
      border-radius: 8px;
      margin: 2px 0;
    }

    .dropdown-item:hover {
      background: #f5f7fb;
    }

    /* Tutorials submenu inside profile dropdown */
    .dropdown-tutorials { position: relative; }
    .tutorials-submenu {
      position: absolute;
      top: 0;
      left: -260px; /* place to the left of the dropdown to avoid clipping */
      width: 240px;
      background: #fff;
      border: 1px solid #eef2f6;
      box-shadow: 0 8px 24px rgba(16,42,67,0.08);
      border-radius: 8px;
      padding: 0.25rem;
      display: none;
      z-index: 1100; /* higher than profile dropdown */
    }
    .tutorials-submenu .tutorial-link {
      display: block;
      padding: 0.5rem 0.6rem;
      color: var(--fg);
      text-decoration: none;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    .tutorials-submenu .tutorial-link:hover { background: #f5f7fb; }
    .tutorials-submenu .tutorial-link.disabled {
      color: #6c757d;
      cursor: default;
      background: transparent;
      pointer-events: none;
    }
    .tutorial-loading {
      padding: 0.5rem 0.6rem;
      color: #6c757d;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }
    .tutorial-spinner {
      width: 0.8rem;
      height: 0.8rem;
      border-radius: 50%;
      border: 2px solid rgba(0,0,0,0.12);
      border-top-color: rgba(0,0,0,0.4);
      animation: spin 0.8s linear infinite;
      display: inline-block;
    }
    .tutorial-spinner { display: none !important; }

    .tutorial-empty { padding: 0.5rem 0.6rem; color: #6c757d; }
    .dropdown-item.logout {
      color: var(--error);
      border-top: 1px solid #eef2f6;
      margin-top: 4px;
      padding-top: 0.6rem;
    }

    /* Make Prompts and Tutorials parent items visually prominent (bold) */
    .dropdown-item.dropdown-prompts,
    .dropdown-item.dropdown-tutorials {
      font-weight: 700;
      color: var(--fg);
    }

    .dropdown-icon {
      width: 16px;
      height: 16px;
      fill: currentColor;
    }

    .logout-button {
      background: rgba(220, 53, 69, 0.1);
      border: 2px solid rgba(220, 53, 69, 0.3);
      color: #dc3545;
      padding: 0.5rem 1rem;
      border-radius: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .logout-button:hover {
      background: rgba(220, 53, 69, 0.2);
      border-color: rgba(220, 53, 69, 0.5);
      transform: translateY(-1px);
    }

    /* Main content area adjustments */
    .main-content {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    .app-mode .main-content {
      align-items: flex-start;
      padding-top: calc(var(--header-height) + 2rem);
      /* make room for the fixed left lesson search panel so content doesn't sit underneath it */
      padding-left: calc(220px + 2rem);
    }
        
    /* Login Page Styles */
    .login-container {
      width: 100%;
      max-width: 400px;
      padding: 2.5em;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo {
      text-align: center;
      margin-bottom: 2em;
    }

    .logo h1 {
      color: var(--brand);
      font-size: 1.8em;
      font-weight: 600;
      margin-bottom: 0.5em;
    }

    .logo p {
      color: #6c757d;
      font-size: 0.9em;
    }

    .form-group {
      margin-bottom: 1.5em;
    }

    label {
      display: block;
      font-size: 0.9em;
      font-weight: 500;
      margin-bottom: 0.5em;
      color: var(--fg);
    }

    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 0.8em 1em;
      font-size: 1em;
      border: 2px solid #e1e5e9;
      border-radius: 0.5em;
      outline: none;
      transition: all 0.3s ease;
      background: #fff;
    }

    input[type="text"]:focus, input[type="password"]:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(0,95,115,0.1);
      transform: translateY(-1px);
    }

    .login-btn {
      width: 100%;
      padding: 0.8em;
      font-size: 1em;
      font-weight: 600;
      border: none;
      border-radius: 0.5em;
      cursor: pointer;
      color: #fff;
      background: var(--brand);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .login-btn:hover {
      background: var(--brand-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,95,115,0.3);
    }

    .login-btn:active {
      transform: translateY(0);
    }

    .login-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .spinner {
      width: 1.2em;
      height: 1.2em;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
    }

    @keyframes spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .message {
      padding: 0.8em 1em;
      border-radius: 0.5em;
      margin-bottom: 1em;
      font-size: 0.9em;
      text-align: center;
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      min-width: 300px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .footer {
      text-align: center;
      margin-top: 2em;
      padding-top: 1.5em;
      border-top: 1px solid #e1e5e9;
      color: #6c757d;
      font-size: 0.8em;
    }

    /* Loading overlay */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
    }

    .loading-text {
      color: var(--brand);
      font-weight: 500;
      margin-left: 1em;
    }

    /* Main App Styles */
    .main-app {
      display: none;
      width: 90vw;
      max-width: 900px;
      padding: 2em;
      background: transparent;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
    }

    /* When app-mode is active and the left panel is fixed, let main-app use the remaining width */
    .app-mode .main-app {
      width: calc(100% - 220px - 4rem); /* panel width + main-content side padding */
      max-width: none;
      margin: 0 auto 2rem auto;
    }

    /* Highlighted row style: apply to main bulk table and per-domain tables */
    #bulkTable tr.highlight td,
    .domain-table tr.highlight td {
      background-color: #ffe58a; /* adjust highlight color as desired */
    }

    /* === Search row highlight === */
    #bulkTable tr.search-hit td {
      background: #fff6a3;      /* pale yellow for search match */
    }

    /* --- Floating search panel (left edge) -------------------- */
    #lesson-search-panel {
      position: fixed;
      top: var(--header-height);
      bottom: var(--footer-height);   /* stop above footer */
      left: 0;
      width: 220px;
      background: var(--card);
      padding: 1rem;
      box-shadow: 2px 0 6px rgba(0,0,0,0.12);
      z-index: 3001;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      overflow-y: auto;
    }

    #lesson-search-panel label {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--fg);
    }

    #lesson-search-panel select,
    #lesson-search-panel input[type="search"] {
      padding: 0.5rem 0.75rem;
      font-size: 0.95rem;
      border-radius: 0.5em;
      border: 1.5px solid #b8c2cc;
      background: #fff;
      width: 100%;
    }

    .panel-title {
      font-size: 1.1rem;
      font-weight: bold;
      color: var(--fg);
      margin-bottom: 0.25rem;
    }

    .panel-subtitle {
      font-size: 0.85rem;
      color: #6c757d;
      margin-bottom: 1rem;
    }

    .app-mode .app-header {
      display: flex;
    }

    .app-mode .main-content {
      background: var(--bg);
    }

/* Responsive: collapse left panel on small viewports and remove extra left padding */
@media (max-width: 900px) {
  #lesson-search-panel {
    position: static;
    width: 100%;
    box-shadow: none;
    order: -1; /* place before main app content */
    display: block;
  }

  .app-mode .main-content {
    padding-left: 1rem; /* no fixed sidebar on small screens */
  }

  body { padding-bottom: calc(var(--footer-height) + 1rem); }
}

    h2 {
      text-align: center; 
      margin-bottom: 1.5em;
      color: var(--brand);
    }

    select, input {
      width: 100%; 
      padding: 0.6em 1em;
      font-size: 1em; 
      border: 1.5px solid #b8c2cc;
      border-radius: 0.5em; 
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    select:focus, input:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(0,95,115,0.1);
    }

    .progress-group { 
      margin-top: 1em; 
      display: none; 
    }

    .progress-bar {
      height: 0.5em; 
      width: 100%; 
      background: #d9e2ec;
      border-radius: 0.25em; 
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%; 
      width: 0%; 
      background: var(--brand);
      transition: width 0.2s;
    }

    .progress-text {
      text-align: right; 
      font-size: 0.85em; 
      margin-top: 0.3em;
      display: none;
    }

    .button-row {
      display: flex; 
      gap: 0.5em; 
      margin-top: 1em;
    }

    button {
      flex: 1; 
      position: relative;
      padding: 0.6em; 
      font-size: 1em; 
      font-weight: 600;
      border: none; 
      border-radius: 0.5em; 
      cursor: pointer;
      color: #fff; 
      transition: background 0.2s;
    }

    .btn-doc { background: var(--brand); }
    .btn-doc:hover { background: var(--brand-dark); }
    .btn-pdf { background: var(--accent); }
    .btn-pdf:hover { background: var(--accent-dark); }
    .btn-form { background: #ee9b00; } /* amber accent */
    .btn-form:hover { background: #c77f00; }
    .btn-package {
      background: #2a9d8f; /* a distinct teal */
    }
    .btn-package:hover {
      background: #21867a; /* darker on hover */
    }
    .btn-view {
      background: var(--brand);
      color: #fff;
      border: none;
      padding: 0.6em 1em;
      font-weight: 600;
      border-radius: 0.5em;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-view:hover {
      background: var(--brand-dark);
    }

    /* Three-stage button styles */
    .btn-check {
      background: #28a745; /* green for check */
    }
    .btn-check:hover {
      background: #218838;
    }
    /* New DONE button style */
    .btn-done {
      background: #28a745;
      color: white;
    }
    .btn-done:hover {
      background: #218838;
    }

    button[disabled] { 
      opacity: 0.6; 
      cursor: default; 
    }

    /* Center text in Stop Bulk button */
    #btnStopBulk {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Pulse animation for package button */
    @keyframes pulse {
      0% { transform: scale(1); background-color: #2a9d8f; }
      50% { transform: scale(1.05); background-color: #21867a; }
      100% { transform: scale(1); background-color: #2a9d8f; }
    }

    .btn-pulsing {
      animation: pulse 1.5s ease-in-out infinite;
    }

    /* Preview buttons matching lesson code cell color */
    .btn-preview {
      background: #d9e2ec;
      color: var(--fg);
      border: none;          /* remove outline */
      font-weight: normal;   /* normal text weight */
      box-shadow: none;      /* remove any shadow */
      white-space: nowrap;
    }

    .btn-preview:hover:not([disabled]) {
      background: #c8d9e2;
    }

    /* Compact icon buttons */
    .icon-btn {
      background: transparent;
      border: none;
      width: 1.5em;
      height: 1.5em;
      padding: 0;
      margin: 0;
      font-size: 1.2em;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .icon-btn:hover {
      background: rgba(0,0,0,0.1);
      border-radius: 0.25em;
    }

    /* Menu button */
    .menu-btn {
      background: transparent;
      border: none;
      font-size: 1.25em;
      cursor: pointer;
      color: var(--fg);
      padding: 0 0.5em;
    }

    .menu-btn:hover {
      background: rgba(0,0,0,0.05);
      border-radius: 0.25em;
    }

    /* Style for per-row action dropdown */
    .action-select {
      width: 100%;
      padding: 0.3em;
      font-size: 0.9em;
      border: 1px solid #b8c2cc;
      border-radius: 0.25em;
      cursor: pointer;
    }

    .main-app .spinner {
      width: 1em; 
      height: 1em;
      border: 2px solid rgba(0,0,0,0.2);
      border-top-color: var(--brand);
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
      position: absolute; 
      top: 50%; 
      left: 50%;
      transform: translate(-50%,-50%);
      display: none;
    }


    /* Unified blink animation used throughout the app */
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50%      { opacity: 0.12; }
    }

    .blinkPopup {
      animation: blink 1s ease-in-out infinite;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    .fadeIn {
      animation: fadeIn 0.5s ease-in-out forwards;
    }

    /*
     * .table-blinking is a marker used by JS to indicate the table is in a loading
     * state. Do NOT attach the blink animation here to avoid double-animation when
     * individual rows/cells also use the .blinking class. Cells/rows that should
     * animate must use the .blinking class directly (applies to TR elements).
     */
  /* marker used by JS to indicate loading state; keep a no-op declaration to avoid empty-ruleset lint errors */
  .table-blinking { animation: none; }

    /* Apply blinking animation to each cell in a blinking row; keep duration consistent */
    .blinking td {
      animation: blink 1.25s ease-in-out infinite;
    }

    /* UI-level blinking for small icon buttons and context menu items.
     * This targets only the element itself (not its children) to avoid
     * colliding with row-level .blinking td animations. Use `.blinking-ui`
     * for generic UI elements and `.bundle-blinking` for bundle-specific icons.
     */
      /* bundle-specific blinking styles removed */
      .blinking-ui svg {
        display: inline-block;
        transform-origin: center center;
        animation: blinkIcon 800ms linear infinite;
      }

      /* Blink keyframes for small UI icons */
      @keyframes blinkIcon {
        0% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.35; transform: scale(0.95); }
        100% { opacity: 1; transform: scale(1); }
      }

      /* Ensure the whole button shows blinking visual (shadow + background) when active */
      .btn-icon.blinking-ui {
        box-shadow: 0 0 0 4px rgba(10, 99, 115, 0.06) inset;
      }

      /* Make context menu items visibly blink when the class is applied */
      .context-menu__item.blinking-ui {
        animation: blinkIcon 800ms linear infinite;
        background: rgba(10, 99, 115, 0.06);
        color: inherit;
      }

    /* Highlight effect for package button on state change */
    .btn-change-effect {
      animation: highlightButton 0.5s ease;
    }
    @keyframes highlightButton {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 rgba(255,255,255,0);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 8px rgba(255,255,255,0.6);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 rgba(255,255,255,0);
      }
    }

    /* Modern bulk table styles */
    /* Container for scrollable table */
    .table-scroll-container {
      height: 100%;      /* take full height of the new fixed panel */
      overflow-y: auto;
      overflow-x: auto; /* allow horizontal scroll instead of overflow past viewport */
      max-width: 100%;
    }
    /* --- Main table panel (right side) – matches left panel height & padding --- */
    #bulkTableContainer {
      position: fixed;
      top: var(--header-height);          /* starts just below the header */
      bottom: var(--footer-height, 0);    /* stops just above the footer */
      left: 220px;                        /* sits right beside the 220‑px left panel */
      right: 0;                           /* stretches to the viewport edge */
      padding: 1rem;                      /* same internal padding as the left panel */
      background: transparent;
      overflow-y: auto;                   /* independent scrolling */
      transition: right 0.3s ease;
    }

    #bulkTable {
      width: 100%;
      border-collapse: collapse;
      font-size: 1em;
      table-layout: fixed; /* prefer fixed layout so columns obey col widths */
    }

    #bulkTable th, #bulkTable td {
      border: none;
    }

    /* Fix: allow cells to shrink and set sane column widths so table doesn't push past container */
    .domain-table th, .domain-table td, #bulkTable th, #bulkTable td {
      min-width: 0; /* prevents long content from forcing column to expand unexpectedly */
    }

    /* Explicit column widths (fallback for browsers that respect col widths) */
    .domain-table col:nth-child(1), #bulkTable col:nth-child(1) { width: var(--col-grade); }
    .domain-table col:nth-child(2), #bulkTable col:nth-child(2) { width: 100px; /* lesson */ }
    .domain-table col:nth-child(3), #bulkTable col:nth-child(3) { width: var(--col-worksheet); }
    .domain-table col:nth-child(4), #bulkTable col:nth-child(4) { width: var(--col-answer); }
    .domain-table col:nth-child(5), #bulkTable col:nth-child(5) { width: var(--col-lastedit); }
  .domain-table col:nth-child(6), #bulkTable col:nth-child(6) { width: 100px; /* package/actions */ }

    /* Package menu: non-sticky to avoid causing horizontal overflow; keep visual spacing via padding */
    .domain-table th.menu-cell.package,
    .domain-table td.menu-cell.package,
    #bulkTable th.menu-cell.package,
    #bulkTable td.menu-cell.package {
      right: auto;
      position: static;
      box-shadow: none;
      padding-right: 0.75rem;
    }

    /* Header pills */
    #bulkTable thead th {
      background: var(--brand);
      color: #fff;
      padding: 0.75em 1em;
      text-align: left;
      position: sticky;
      top: 0;
      background: var(--brand);
      z-index: 2;
    }

    #bulkTable thead th:first-child {
      border-top-left-radius: 0.5em;
    }

    #bulkTable thead th:last-child {
      border-top-right-radius: 0.5em;
    }

    /* Prevent table cell content from wrapping */
    #bulkTable th,
    #bulkTable td {
      white-space: nowrap;
    }

    /* Row cards */
    #bulkTable tr {
      background: #fff;
    }

    /* First column styling */

      /* On very narrow viewports, allow the table to behave as a block inside the scroll container so it can be scrolled without pushing outside the container */
      @media (max-width: 720px) {
        .table-scroll-container table { display: block; width: auto; max-width: 100%; }
      }
    #bulkTable td:first-child {
      background: #d9e2ec;
      color: var(--fg);
      padding: 0.75em 1em;
      border-radius: 0;
    }

    /* Last (Actions) column styling */
    #bulkTable td.actions {
      background: var(--accent-dark);
      color: #fff;
      padding: 0.75em 1em;
      border-top-right-radius: 0.5em;
      border-bottom-right-radius: 0.5em;
    }

    #bulkTable td.menu-cell {
      background: #f7fbfc;
      color: var(--fg);
      padding: 0.75em 1em;
      border-radius: 0;
      text-align: right;
    }

    /* Middle cells */
    #bulkTable td {
      background: #f7fbfc;
      padding: 0.75em 1em;
      color: var(--fg);
    }

    /* Button cells remove extra padding */
    #bulkTable td.actions select {
      background: transparent;
      color: #fff;
      border: none;
      width: auto;
    }

    /* Worksheet and Answer Key column styling */
    #bulkTable th.col-worksheet,
    #bulkTable td.col-worksheet {
      background: #e0f2f1; /* a soft teal */
    }

    #bulkTable th.col-answer,
    #bulkTable td.col-answer {
      background: #f1f8e9; /* a soft green */
    }

    /* Context menu styling */
    #contextMenu {
      position: absolute;
      z-index: 10002; /* above popup */
      display: none;
      background: #fff;
      border: none;
      border-radius: 0.5em;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .context-menu__item {
      padding: 0.75em 1em;
      cursor: pointer;
      white-space: nowrap;
      font-size: 0.95em;
    }

    .context-menu__item + .context-menu__item {
      border-top: 1px solid #eee;
    }

    .context-menu__item:hover {
      background: #f0f0f0;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .profile-button { font-size: 0.8rem; padding: 0.35rem 0.6rem; }
      .profile-username, .profile-account { max-width: 100px; }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 1em;
      }
            
      .login-container, .main-app {
        padding: 2em;
      }
            
      .logo h1 {
        font-size: 1.5em;
      }

      .app-header {
        padding: 0 0.5rem;
      }

      .header-logo {
        font-size: 1.2rem;
      }

      .earnings-display {
        display: none;
      }
    }

    /* Hide login when app is shown */
    .app-mode .login-container {
      display: none;
    }

    .app-mode .main-app {
      display: block;
    }
  /* Site-wide footer */
  .site-footer {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    height: var(--footer-height);
    background: var(--brand-dark);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 1rem;
    margin: 0;              /* override previous margin-top */
    z-index: 1000;
  }
  .site-footer a {
    color: var(--accent);
    text-decoration: underline;
  }

  /* so non-fixed content never hides under the footer */
  body { padding-bottom: var(--footer-height); }

  /* ==== Hide all loading spinners – user no longer wants the circles ==== */
  .spinner {
    display: none !important;
  }

  /* Hide lesson search panel on login page */
body:not(.app-mode) #lesson-search-panel {
  display: none;
  }

        /* bundle-related styles removed (panel moved into domain headers) */

/* Remove shadows from main app and containers */
.main-app {
  box-shadow: none !important;
}

#bulkTableContainer {
  box-shadow: none !important;
  width: auto !important; /* allow left/right fixed positioning to define width, avoids forcing extra full-width */
}

/* bundle-related styles removed (panel moved into domain headers) */

